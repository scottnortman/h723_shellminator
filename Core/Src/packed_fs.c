/*
 * packed_fs.c
 *
 *  Created on: Jun 6, 2025
 *      Author: snortman
 */


#include <stddef.h>
#include <string.h>
#include <time.h>

#if defined(__cplusplus)
extern "C" {
#endif

const char *mg_unlist(size_t no);
const char *mg_unpack(const char *, size_t *, time_t *);

#if defined(__cplusplus)
}
#endif

static const unsigned char v1[] = {60,33,68,79,67,84,89,80,69,32,104,116,109,108,62,10,60,104,116,109,108,62,10,60,104,101,97,100,62,10,32,32,60,108,105,110,107,32,104,114,101,102,61,34,115,116,121,108,101,46,99,115,115,34,32,114,101,108,61,34,115,116,121,108,101,115,104,101,101,116,34,32,47,62,10,60,47,104,101,97,100,62,10,60,98,111,100,121,62,10,32,32,60,100,105,118,32,99,108,97,115,115,61,34,109,97,105,110,34,62,10,32,32,32,32,60,104,49,62,77,121,32,68,101,118,105,99,101,60,47,104,49,62,10,32,32,32,32,60,115,112,97,110,62,76,69,68,32,115,116,97,116,117,115,58,60,47,115,112,97,110,62,10,32,32,32,32,60,115,112,97,110,32,105,100,61,34,115,116,97,116,117,115,34,62,48,60,47,115,112,97,110,62,10,32,32,32,32,60,98,117,116,116,111,110,32,105,100,61,34,98,116,110,34,62,84,111,103,103,108,101,32,76,69,68,60,47,98,117,116,116,111,110,62,10,32,32,32,32,60,112,62,60,115,109,97,108,108,62,78,111,116,101,58,32,116,104,105,115,32,85,73,32,105,115,32,105,110,116,101,110,116,105,111,110,97,108,108,121,32,109,105,110,105,109,97,108,60,47,115,109,97,108,108,62,60,47,112,62,10,32,32,60,47,100,105,118,62,10,32,32,60,115,99,114,105,112,116,32,115,114,99,61,34,109,97,105,110,46,106,115,34,62,60,47,115,99,114,105,112,116,62,10,60,47,98,111,100,121,62,10,60,47,104,116,109,108,62,0};
static const unsigned char v2[] = {46,109,97,105,110,32,32,123,32,109,97,114,103,105,110,58,32,49,101,109,59,32,125,10,35,115,116,97,116,117,115,32,123,32,100,105,115,112,108,97,121,58,32,105,110,108,105,110,101,45,98,108,111,99,107,59,32,119,105,100,116,104,58,32,50,101,109,59,32,125,10,0};
static const unsigned char v3[] = {10,118,97,114,32,103,101,116,83,116,97,116,117,115,32,61,32,101,118,32,61,62,32,102,101,116,99,104,40,39,97,112,105,47,108,101,100,47,103,101,116,39,41,10,32,32,46,116,104,101,110,40,114,32,61,62,32,114,46,106,115,111,110,40,41,41,10,32,32,46,116,104,101,110,40,114,32,61,62,32,123,32,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,66,121,73,100,40,39,115,116,97,116,117,115,39,41,46,105,110,110,101,114,72,84,77,76,32,61,32,114,59,32,125,41,59,10,10,118,97,114,32,116,111,103,103,108,101,32,61,32,101,118,32,61,62,32,102,101,116,99,104,40,39,97,112,105,47,108,101,100,47,116,111,103,103,108,101,39,41,10,32,32,46,116,104,101,110,40,114,32,61,62,32,103,101,116,83,116,97,116,117,115,40,41,41,59,10,10,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,66,121,73,100,40,39,98,116,110,39,41,46,111,110,99,108,105,99,107,32,61,32,116,111,103,103,108,101,59,10,47,47,119,105,110,100,111,119,46,97,100,100,69,118,101,110,116,76,105,115,116,101,110,101,114,40,39,108,111,97,100,39,44,32,103,101,116,83,116,97,116,117,115,41,59,10,0};

static const struct packed_file {
  const char *name;
  const unsigned char *data;
  size_t size;
  time_t mtime;
} packed_files[] = {
  {"/web_root/index.html", v1, sizeof(v1), 0},
  {"/web_root/style.css", v2, sizeof(v2), 0},
  {"/web_root/main.js", v3, sizeof(v3), 0},
  {NULL, NULL, 0, 0}
};

static int scmp(const char *a, const char *b) {
  while (*a && (*a == *b)) a++, b++;
  return *(const unsigned char *) a - *(const unsigned char *) b;
}

const char *mg_unlist(size_t no) {
  return packed_files[no].name;
}

const char *mg_unpack(const char *name, size_t *size, time_t *mtime) {
  const struct packed_file *p;
  for (p = packed_files; p->name != NULL; p++) {
    if (scmp(p->name, name) != 0) continue;
    if (size != NULL) *size = p->size - 1;
    if (mtime != NULL) *mtime = p->mtime;
    return (const char *) p->data;
  }
  return NULL;
};


